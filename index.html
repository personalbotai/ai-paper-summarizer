<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Paper Summarizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .paper-card { transition: transform 0.2s, box-shadow 0.2s; }
        .paper-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3); }
        .tag { display: inline-block; padding: 0.25rem 0.5rem; background: rgba(59, 130, 246, 0.2); color: #60a5fa; border-radius: 0.25rem; font-size: 0.75rem; margin-right: 0.25rem; margin-bottom: 0.25rem; }
        .skeleton { background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .markdown-body { line-height: 1.7; }
        .markdown-body h1, .markdown-body h2, .markdown-body h3 { margin-top: 1.5em; margin-bottom: 0.5em; font-weight: 600; }
        .markdown-body p { margin-bottom: 1em; }
        .markdown-body ul, .markdown-body ol { margin-bottom: 1em; padding-left: 1.5em; }
        .markdown-body code { background: rgba(0,0,0,0.3); padding: 0.2em 0.4em; border-radius: 0.25em; font-family: monospace; }
        .markdown-body pre { background: #1e293b; padding: 1em; border-radius: 0.5em; overflow-x: auto; margin: 1em 0; }
        .markdown-body blockquote { border-left: 4px solid #3b82f6; padding-left: 1em; color: #9ca3af; margin: 1em 0; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <nav class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-robot text-blue-400 text-xl mr-2"></i>
                    <span class="text-xl font-bold text-blue-400">AI Paper Summarizer</span>
                    <span class="ml-2 px-2 py-0.5 bg-purple-900 text-purple-300 text-xs rounded">Beta</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="openSettings()" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                        <i class="fas fa-cog mr-1"></i> Settings
                    </button>
                    <button onclick="openHistory()" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">
                        <i class="fas fa-history mr-1"></i> History
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg max-w-lg w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white">Settings</h2>
                <button onclick="closeSettings()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">AI Provider</label>
                    <select id="ai-provider" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600">
                        <option value="openai">OpenAI (GPT-3.5/4)</option>
                        <option value="anthropic">Anthropic (Claude)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">API Key</label>
                    <input type="password" id="api-key" placeholder="sk-..." class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600">
                    <p class="text-xs text-gray-500 mt-1">Your API key is stored locally and never sent to our servers.</p>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Model</label>
                    <select id="ai-model" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600">
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        <option value="gpt-4">GPT-4</option>
                        <option value="claude-instant-1">Claude Instant 1</option>
                        <option value="claude-2">Claude 2</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Summary Length</label>
                    <select id="summary-length" class="w-full bg-gray-700 text-white px-3 py-2 rounded border border-gray-600">
                        <option value="short">Short (1 paragraph)</option>
                        <option value="medium" selected>Medium (2-3 paragraphs)</option>
                        <option value="long">Long (detailed)</option>
                    </select>
                </div>
            </div>
            <div class="mt-6 flex justify-end">
                <button onclick="saveSettings()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white">Search History</h2>
                <button onclick="closeHistory()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="history-list" class="space-y-3">
                    <!-- History items -->
                </div>
                <div class="mt-4 flex justify-end">
                    <button onclick="clearHistory()" class="text-red-400 hover:text-red-300 text-sm">Clear All History</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Paper Detail Modal -->
    <div id="paper-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white" id="modal-title">Paper Details</h2>
                <button onclick="closePaperModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="modal-content"></div>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Hero Search -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-4">AI Research Paper Summarizer</h1>
            <p class="text-gray-400 max-w-2xl mx-auto">
                Get instant AI-generated summaries of AI/ML research papers from ArXiv.
                Enter a paper ID, URL, or search by keywords.
            </p>
        </div>

        <!-- Search Box -->
        <div class="max-w-3xl mx-auto mb-12">
            <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                <div class="flex flex-col md:flex-row gap-4 mb-4">
                    <div class="flex-1">
                        <input type="text" id="search-input" placeholder="arXiv ID (e.g., 2301.07041) or search keywords..." class="w-full bg-gray-700 text-white px-4 py-3 rounded-lg border border-gray-600 focus:outline-none focus:border-blue-500">
                    </div>
                    <button id="search-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg flex items-center justify-center">
                        <i class="fas fa-search mr-2"></i> Search
                    </button>
                </div>
                <div class="text-sm text-gray-400">
                    <i class="fas fa-lightbulb mr-1"></i>
                    Try: <button class="text-blue-400 hover:underline" data-search="transformer">"transformer"</button> or 
                    <button class="text-blue-400 hover:underline" data-search="2301.07041">2301.07041</button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="hidden max-w-4xl mx-auto">
            <div class="bg-gray-800 rounded-lg p-8 text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                <p class="text-gray-300" id="loading-text">Fetching papers...</p>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="max-w-4xl mx-auto">
            <!-- Paper cards will be inserted here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="max-w-4xl mx-auto">
            <div class="bg-gray-800 rounded-lg p-12 text-center">
                <i class="fas fa-robot text-6xl text-gray-600 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-300 mb-2">Ready to Summarize</h3>
                <p class="text-gray-400">Search for AI research papers or enter an arXiv ID to get started.</p>
            </div>
        </div>
    </main>

    <script>
        // API Configuration
        const ARXIV_API = 'https://export.arxiv.org/api/query';
        let state = {
            papers: [],
            currentPaper: null,
            summaryCache: new Map(),
            searchHistory: JSON.parse(localStorage.getItem('arxiv-search-history') || '[]')
        };

        // DOM Elements
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const loadingEl = document.getElementById('loading');
        const loadingText = document.getElementById('loading-text');
        const resultsEl = document.getElementById('results');
        const emptyState = document.getElementById('empty-state');

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            bindEvents();
            renderHistory();
        });

        function bindEvents() {
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
            document.querySelectorAll('[data-search]').forEach(btn => {
                btn.addEventListener('click', () => {
                    searchInput.value = btn.dataset.search;
                    performSearch();
                });
            });
        }

        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) return;

            showLoading('Searching ArXiv...');
            emptyState.classList.add('hidden');
            resultsEl.innerHTML = '';

            try {
                let papers = [];
                
                if (/^\d{4}\.\d{4,5}$/.test(query) || /^arXiv:\d{4}\.\d{4,5}/.test(query)) {
                    const arxivId = query.replace('arXiv:', '');
                    papers = await fetchPaperById(arxivId);
                    addToHistory({ type: 'id', query: arxivId, timestamp: new Date().toISOString() });
                } else {
                    papers = await searchPapers(query);
                    addToHistory({ type: 'search', query: query, timestamp: new Date().toISOString() });
                }

                state.papers = papers;
                displayResults(papers);
                
                if (papers.length === 0) {
                    showEmpty('No papers found. Try different keywords.');
                }

            } catch (error) {
                showError('Failed to fetch papers: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function fetchPaperById(id) {
            const response = await fetch(
                `${ARXIV_API}?id=arXiv:${id}&start=0&max_results=1`,
                { headers: { 'Accept': 'application/atom+xml' } }
            );
            if (!response.ok) throw new Error('ArXiv API error');
            const xml = await response.text();
            return parseArXivXML(xml);
        }

        async function searchPapers(keywords) {
            const response = await fetch(
                `${ARXIV_API}?search_query=all:${encodeURIComponent(keywords)}&start=0&max_results=15`,
                { headers: { 'Accept': 'application/atom+xml' } }
            );
            if (!response.ok) throw new Error('ArXiv API error');
            const xml = await response.text();
            return parseArXivXML(xml);
        }

        function parseArXivXML(xml) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(xml, 'text/xml');
            const entries = doc.querySelectorAll('entry');
            const papers = [];

            entries.forEach(entry => {
                const id = entry.querySelector('id').textContent;
                const title = entry.querySelector('title').textContent.trim();
                const summary = entry.querySelector('summary').textContent.trim();
                const published = new Date(entry.querySelector('published').textContent);
                const updated = new Date(entry.querySelector('updated').textContent);
                
                const authors = [];
                entry.querySelectorAll('author name').forEach(author => {
                    authors.push(author.textContent);
                });

                const categories = [];
                entry.querySelectorAll('category').forEach(cat => {
                    categories.push(cat.getAttribute('term'));
                });

                const pdfLink = entry.querySelector('link[title="pdf"]');
                const pdfUrl = pdfLink ? pdfLink.getAttribute('href') : '';

                papers.push({
                    id: id.split('/').pop(),
                    title,
                    summary,
                    published,
                    updated,
                    authors,
                    categories,
                    pdfUrl
                });
            });

            return papers;
        }

        function displayResults(papers) {
            resultsEl.innerHTML = papers.map(paper => `
                <div class="paper-card bg-gray-800 rounded-lg p-6 mb-6 cursor-pointer" data-paper-id="${paper.id}">
                    <h3 class="text-xl font-bold text-white mb-3">${paper.title}</h3>
                    <div class="flex flex-wrap items-center gap-2 mb-3">
                        ${paper.categories.map(cat => `<span class="tag">${cat}</span>`).join('')}
                        <span class="text-sm text-gray-400">
                            <i class="far fa-calendar-alt mr-1"></i>${paper.published.toLocaleDateString()}
                        </span>
                    </div>
                    <p class="text-gray-300 mb-4 line-clamp-3">${paper.summary}</p>
                    <div class="flex items-center justify-between">
                        <div class="text-sm text-gray-400">
                            <i class="fas fa-user mr-1"></i>${paper.authors.slice(0, 3).join(', ')}${paper.authors.length > 3 ? ' et al.' : ''}
                        </div>
                        <button class="text-blue-400 hover:text-blue-300 font-medium view-summary-btn" data-paper='${JSON.stringify(paper).replace(/'/g, "&apos;")}'>
                            <i class="fas fa-robot mr-1"></i> AI Summary
                        </button>
                    </div>
                </div>
            `).join('');

            // Attach click handlers
            document.querySelectorAll('.view-summary-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const paper = JSON.parse(btn.dataset.paper.replace(/&apos;/g, "'"));
                    showPaperSummary(paper);
                });
            });
        }

        async function showPaperSummary(paper) {
            openPaperModal(paper);
            const contentEl = document.getElementById('modal-content');
            
            // Check cache first
            const cacheKey = paper.id;
            if (state.summaryCache.has(cacheKey)) {
                contentEl.innerHTML = state.summaryCache.get(cacheKey);
                return;
            }

            contentEl.innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-center justify-center py-8">
                        <div class="inline-block animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"></div>
                        <span class="ml-3 text-gray-300">Generating AI summary...</span>
                    </div>
                </div>
            `;

            try {
                const summary = await generateAISummary(paper);
                const html = renderSummaryContent(paper, summary);
                state.summaryCache.set(cacheKey, html);
                contentEl.innerHTML = html;
            } catch (error) {
                contentEl.innerHTML = `
                    <div class="bg-red-900 border border-red-700 rounded-lg p-6 text-center">
                        <i class="fas fa-exclamation-triangle text-red-400 text-3xl mb-3"></i>
                        <p class="text-red-200">Failed to generate summary: ${error.message}</p>
                        <p class="text-gray-400 mt-2 text-sm">Make sure you have configured your API key in Settings.</p>
                    </div>
                `;
            }
        }

        async function generateAISummary(paper) {
            const settings = getSettings();
            if (!settings.apiKey) {
                throw new Error('API key not configured. Please set it in Settings.');
            }

            const prompt = `Summarize the following AI research paper in ${settings.summaryLength} detail (1-3 paragraphs). Include: objective, methodology, key findings, and conclusion.

Title: ${paper.title}
Authors: ${paper.authors.join(', ')}
Categories: ${paper.categories.join(', ')}
Abstract: ${paper.summary}

Provide a clear, structured summary suitable for researchers.`;

            if (settings.provider === 'openai') {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${settings.apiKey}`
                    },
                    body: JSON.stringify({
                        model: settings.model,
                        messages: [
                            { role: 'system', content: 'You are a research assistant that summarizes academic papers accurately and concisely.' },
                            { role: 'user', content: prompt }
                        ],
                        temperature: 0.5,
                        max_tokens: settings.summaryLength === 'short' ? 300 : settings.summaryLength === 'medium' ? 600 : 1000
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error?.message || 'OpenAI API error');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } else {
                // Anthropic
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': settings.apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: settings.model,
                        max_tokens: settings.summaryLength === 'short' ? 300 : settings.summaryLength === 'medium' ? 600 : 1000,
                        messages: [
                            { role: 'user', content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error?.message || 'Anthropic API error');
                }

                const data = await response.json();
                return data.content[0].text;
            }
        }

        function renderSummaryContent(paper, summary) {
            return `
                <div class="space-y-6">
                    <!-- Metadata -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${paper.categories.map(cat => `<span class="tag">${cat}</span>`).join('')}
                    </div>
                    
                    <!-- Authors -->
                    <div>
                        <h4 class="text-sm font-semibold text-gray-400 mb-2">Authors</h4>
                        <p class="text-gray-300">${paper.authors.join(', ')}</p>
                    </div>
                    
                    <!-- Dates -->
                    <div class="flex gap-4 text-sm text-gray-400">
                        <span><i class="far fa-calendar-alt mr-1"></i>Published: ${paper.published.toLocaleDateString()}</span>
                        <span><i class="far fa-edit mr-1"></i>Updated: ${paper.updated.toLocaleDateString()}</span>
                    </div>
                    
                    <!-- PDF Link -->
                    ${paper.pdfUrl ? `
                    <div>
                        <a href="${paper.pdfUrl}" target="_blank" class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
                            <i class="fas fa-file-pdf mr-2"></i> Download PDF
                        </a>
                    </div>
                    ` : ''}
                    
                    <hr class="border-gray-700">
                    
                    <!-- AI Summary -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-3 flex items-center">
                            <i class="fas fa-robot text-blue-400 mr-2"></i> AI-Generated Summary
                        </h4>
                        <div class="markdown-body text-gray-300">
                            ${marked.parse(summary)}
                        </div>
                    </div>
                    
                    <hr class="border-gray-700">
                    
                    <!-- Abstract -->
                    <div>
                        <h4 class="text-lg font-semibold text-white mb-3">Abstract</h4>
                        <p class="text-gray-300 leading-relaxed">${paper.summary}</p>
                    </div>
                </div>
            `;
        }

        // UI Helpers
        function showLoading(text = 'Loading...') {
            loadingText.textContent = text;
            loadingEl.classList.remove('hidden');
        }

        function hideLoading() {
            loadingEl.classList.add('hidden');
        }

        function showEmpty(message) {
            resultsEl.innerHTML = `
                <div class="bg-gray-800 rounded-lg p-8 text-center">
                    <i class="fas fa-search text-gray-500 text-4xl mb-3"></i>
                    <p class="text-gray-300">${message}</p>
                </div>
            `;
        }

        function showError(message) {
            resultsEl.innerHTML = `
                <div class="bg-red-900 border border-red-700 rounded-lg p-6 text-center">
                    <i class="fas fa-exclamation-triangle text-red-400 text-3xl mb-3"></i>
                    <p class="text-red-200">${message}</p>
                </div>
            `;
        }

        function openPaperModal(paper) {
            document.getElementById('paper-modal').classList.remove('hidden');
            document.getElementById('modal-title').textContent = paper.title;
        }

        function closePaperModal() {
            document.getElementById('paper-modal').classList.add('hidden');
        }

        // Settings
        function openSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }

        function saveSettings() {
            const settings = {
                provider: document.getElementById('ai-provider').value,
                apiKey: document.getElementById('api-key').value.trim(),
                model: document.getElementById('ai-model').value,
                summaryLength: document.getElementById('summary-length').value
            };
            localStorage.setItem('ai-summarizer-settings', JSON.stringify(settings));
            closeSettings();
            showToast('Settings saved!');
        }

        function loadSettings() {
            const saved = localStorage.getItem('ai-summarizer-settings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('ai-provider').value = settings.provider || 'openai';
                document.getElementById('api-key').value = settings.apiKey || '';
                document.getElementById('ai-model').value = settings.model || 'gpt-3.5-turbo';
                document.getElementById('summary-length').value = settings.summaryLength || 'medium';
                updateModelOptions();
            }
            
            // Update model options when provider changes
            document.getElementById('ai-provider').addEventListener('change', updateModelOptions);
        }

        function updateModelOptions() {
            const provider = document.getElementById('ai-provider').value;
            const modelSelect = document.getElementById('ai-model');
            modelSelect.innerHTML = '';
            
            if (provider === 'openai') {
                modelSelect.innerHTML = `
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    <option value="gpt-4">GPT-4</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                `;
            } else {
                modelSelect.innerHTML = `
                    <option value="claude-instant-1">Claude Instant 1</option>
                    <option value="claude-2">Claude 2</option>
                    <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                    <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                `;
            }
        }

        // History
        function openHistory() {
            document.getElementById('history-modal').classList.remove('hidden');
            renderHistory();
        }

        function closeHistory() {
            document.getElementById('history-modal').classList.add('hidden');
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            if (state.searchHistory.length === 0) {
                list.innerHTML = '<p class="text-gray-500 italic">No search history yet.</p>';
                return;
            }
            
            list.innerHTML = state.searchHistory.slice(0, 20).map((item, idx) => `
                <div class="bg-gray-700 p-3 rounded cursor-pointer hover:bg-gray-600 flex justify-between items-center" onclick="loadHistoryItem('${item.query}')">
                    <div>
                        <div class="font-medium text-white">${item.query}</div>
                        <div class="text-xs text-gray-400">${new Date(item.timestamp).toLocaleString()}</div>
                    </div>
                    <span class="px-2 py-1 bg-gray-600 text-xs rounded">${item.type === 'id' ? 'ID' : 'Search'}</span>
                </div>
            `).join('');
        }

        function loadHistoryItem(query) {
            searchInput.value = query;
            closeHistory();
            performSearch();
        }

        function addToHistory(item) {
            state.searchHistory.unshift(item);
            if (state.searchHistory.length > 50) state.searchHistory.pop();
            localStorage.setItem('arxiv-search-history', JSON.stringify(state.searchHistory));
        }

        function clearHistory() {
            if (confirm('Clear all search history?')) {
                state.searchHistory = [];
                localStorage.removeItem('arxiv-search-history');
                renderHistory();
            }
        }

        function getSettings() {
            const saved = localStorage.getItem('ai-summarizer-settings');
            return saved ? JSON.parse(saved) : {
                provider: 'openai',
                apiKey: '',
                model: 'gpt-3.5-turbo',
                summaryLength: 'medium'
            };
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg text-white bg-green-600 z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Modal outside click
        document.getElementById('settings-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeSettings();
        });
        document.getElementById('history-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeHistory();
        });
        document.getElementById('paper-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closePaperModal();
        });
    </script>
</body>
</html>
